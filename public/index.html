<!--
// SCDHHS 
// Author: Brian Palmer
// Date: March 24, 2025
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCDHHS</title>
    <link rel="stylesheet" href="styles.css">

    <!-- Load AWS Amplify -->
    <script type="module">
        import { Amplify, Auth } from 'https://cdnjs.cloudflare.com/ajax/libs/aws-amplify/5.3.11/aws-amplify.min.js';
        import awsconfig from './auth-config.js';

        Amplify.configure(awsconfig);
        window.Auth = Auth;  // Expose Auth globally for use in scripts
    </script>
</head>

<body>
    <div class="container">
        <div class="header-bar">
            <h1>Welcome to Healthlake</h1>
            <div class="user-info">
                <span id="username-display"></span>
                <button id="login-btn" class="btn-secondary">Login</button>
                <button id="logout-btn" class="btn-secondary" style="display: none;">Logout</button>
            </div>
        </div>

        <p>Cognito User Pool User Authentication.</p>
    </div>

<script>
    window.onload = async function() {
        // Load AWS Amplify dynamically to avoid import issues
        const script = document.createElement("script");
        script.src = "https://cdnjs.cloudflare.com/ajax/libs/aws-amplify/5.3.11/aws-amplify.min.js";
        script.onload = function() {
            console.log("AWS Amplify loaded");
            configureAuth();
        };
        document.head.appendChild(script);
    };

    function configureAuth() {
        fetch('./auth-config.js')
            .then(response => response.json())
            .then(awsconfig => {
                Amplify.configure(awsconfig);
                window.Auth = Amplify.Auth;
                checkAuth();
            })
            .catch(error => console.error("Failed to load auth config", error));
    }

    async function checkAuth() {
        try {
            const user = await Auth.currentAuthenticatedUser();
            console.log('User is signed in:', user);
            document.getElementById('username-display').textContent = user.username || 'Authenticated User';
            document.getElementById('logout-btn').style.display = 'block';
            document.getElementById('login-btn').style.display = 'none';
        } catch (error) {
            console.log('User is not signed in');
            document.getElementById('logout-btn').style.display = 'none';
            document.getElementById('login-btn').style.display = 'block';
        }
    }
</script>

</body>
</html>
